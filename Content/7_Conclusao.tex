\chapter{Conclusão}
\label{Conclusao}

\par Nesta monografia foi apresentado o projeto SOFIA, um simulador do Arduino UNO criado para Android.

\par Pode-se dizer que o sistema desenvolvido atende aos objetivos propostos: o sistema é capaz de executar códigos escritos para o Arduino UNO (ATmega328P) diretamente no dispositivo Android, bem como permitir que o usuário interaja com o sistema por meio de sinais de entrada (digital e analógico) ou fazendo medições dos estados dos pinos digitais. O simulador também conta com um monitor serial e com recursos para depuração do código simulado, tais como frequencímetro e mapa de memória. O usuário tem ainda a disposição uma IDE Arduino que foi modificada para facilitar o processo de transferência de códigos entre PC e simulador.

\par No inicio do projeto, a arquitetura projetada e as técnicas de desenvolvimento estavam muito atreladas à experiência que se tinha com aplicações \textit{desktop}, o que contribuiu para que muitas das escolhas de implementação não resultarem na melhor solução do problema em um sistema \textit{mobile}. Na seção~\ref{profiling}, por exemplo, mostrou-se o problema relacionado com a estrutura \textit{Enum}, e posteriormente descobriu-se que esta não é uma estrutura recomendada para se utilizar no Android.

\par No entanto, o principal problema encontrado na arquitetura projetada, que veio a impactar seriamente o desempenho do simulador, foi o uso de \textit{threads}. \textit{Thread} é um recurso importante e muito poderoso e seu uso no Android é muitas vezes inevitável, já que o sistema não permite que operações de E/S sejam realizadas na \textit{thread} principal. No entanto, a arquitetura original contava com 6 \textit{threads} permanentes e diversas \textit{AsyncTasks} criadas dinamicamente, o que tornava o sistema cerca de 10.000x mais lento que o atual mostrado neste trabalho (e não contava com todas as funcionalidades desenvolvidas). Aos poucos, esta estratégia inicial foi sendo substituída por uma abordagem de \textit{thread} única, mas ainda existem trechos de código residual que não puderam ser refatorados. 

\par Outro ponto importante que se pode concluir é a respeito dos testes realizados. O desenvolvimento de testes de unidade automatizados foi uma atividade que consumiu bastante tempo (um dos motivos foi a inexperiência do autor com as ferramentas utilizadas), porém ajudaram a identificar defeitos que seriam difíceis de depurar caso não tivessem sido corrigidos, mostrando sua importância para a qualidade do \textit{software} em desenvolvimento.

\par Em comparação com outros aplicativos, como apresentado na seção~\ref{sec:comparacao}, o simulador desenvolvido apresenta bons resultados em relação aos demais, fazendo deste uma alternativa viável, principalmente por oferecer alguns recursos que não estão presentes em outros simuladores (como ferramentas de depuração). 

%\par Uma limitação encontrada para o projeto foi sua velocidade de simulação. Obviamente, não se esperava atingir velocidades principalmente para aplicações envolvendo temporização. Grandes escalas de tempo (maiores que 10ms) fazem com que a simulação demore a apresentar algum resultado. O principal problema neste caso fica na experiência de integração, onde o projeto passa pelo simulador para ser testado no Arduino posteriormente, forçando o usuário a fazer alterações no código em cada etapa.

\par Por fim, conclui-se que este projeto teve grande importância para o aprendizado de novas tecnologias, principalmente no que diz respeito ao desenvolvimento Android, programação para Arduino, organização e arquitetura do microcontrolador ATmega328P e teste de \textit{software}, além, obviamente, da experiência em se desenvolver um projeto de \textit{software} completo, usando uma metodologia ágil, fazendo a especificação de requisitos e tomando várias decisões de projeto que tiveram grande impacto no produto final.

\section{Trabalhos futuros}

%\par A experiência no desenvolvimento deste trabalho mostrou que ainda existe margem para otimização no código desenvolvido. A arquitetura originalmente pensada foi aos poucos sendo modificada devido à problemas de performance e/ou implementação e pode-se observar que algumas funções poderiam ter sido implementadas de maneira diferente, mas estas já estavam fortemente ligadas ao projeto de modo que a refatoração seria muito custosa em termos de tempo (o mesmo vale para algumas estruturas de dados). Isso ocorreu principalmente pois a visão que se tinha do projeto inicialmente considerava muitos aspectos do desenvolvimento para \textit{desktop}, mas que se mostraram ineficientes para o desenvolvimento \textit{mobile}. A revisão da arquitetura é portanto uma tarefa importante a ser executada para as próximas versões.

\par Muito ainda pode ser feito para melhorar o aplicativo. Como mencionado anteriormente, ainda existe código residual que não pode ser refatorado de uma arquitetura que não se mostrou eficiente, o que causa impacto no desempenho do sistema. Portanto, uma revisão da arquitetura e a adequação do código, buscando estratégias de implementação, algoritmos e estruturas de dados que sejam mais eficientes no Android, é certamente uma tarefa importante para a continuidade do trabalho e para as próximas versões.

\par Além disso, como também foi apontado, a atividade de teste se mostrou importante para a qualidade do código. Outras técnicas de teste, como teste de interface, teste de mutação, etc., não foram aplicados ao projeto nesta versão e podem contribuir ainda mais para tornar o sistema mais confiável.

\par Também, a interface do aplicativo, embora tenha sido planejada para se fosse simples e o mais intuitivo possível, ainda tem muito o que melhorar e é algo a ser pensado junto a revisão da arquitetura. 

\par Em termos de funcionalidades, ainda há vários módulos do Arduino que não foram implementados: modos de hibernação, EEPROM, comparador analógico, SPI, etc. Estas funcionalidades, junto ao suporte de novas placas, trariam mais utilidade ao simulador e o tornaria mais completo.

\par Por fim, um recurso importante, observado nos outros aplicativos, mas que não foi implementado nesta versão são os exemplos pré-compilados já embutidos no simulador. Este recurso daria a possibilidade de um usuário testar o simulador assim que o \textit{download} fosse concluído, não dependendo de nenhum outro \textit{software} ou aplicativo para gerar os códigos mais comuns, como o projeto \textit{Blink} que foi utilizado durante os testes.


%
%\par Entre as limitações do sistema, destaca-se sua performance em termos de velocidade de simulação. A execução de códigos provindos da IDE ainda é lenta devido a quantidade de instruções \textit{assembly} geradas pelo compilador e a capacidade de processamento do \textit{smartphone}. Para o desenvolvimento, foi utilizado um \textit{smartphone} ASUS ZenFone 2, com 4 núcleos de processamento (2,33GHz), 4GB de memória principal, 32GB de armazenamento, executando o Android 5.0, e frequência de \textit{clock} efetiva observada neste sistema foi de aproximadamente 200Hz para o projeto \textit{Blink} (uma redução de 80.000 vezes a velocidade do sistema real). Ainda assim, é possível utilizar o sistema para pequenos projetos (utilizando escalas de tempo reduzidas), o que ainda o torna útil para aplicações didáticas.
%
%\par Em termos de arquitetura, o sistema buscou preservar os mesmos módulos e fluxos de comunicação existentes no \textit{hardware} do microcontrolador, por motivos, principalmente, de facilidade de implementação e desempenho, o que acabou tornando a arquitetura do \textit{software} um pouco mais complexa. No entanto, o sistema ainda está modular, o que é uma característica importante para sua expansão.
%
%\par Quanto à qualidade do sistema, a análise estática do SonarQube não revelou grandes problemas no código e os principais módulos foram quase que totalmente cobertos por teste. Ainda é necessária a criação de muitos casos de teste para cobrir todo o projeto e garantir um nível maior de qualidade, estes estão sendo desenvolvidos em ordem de prioridade para os demais módulos.
%
%\par Para a continuidade do projeto, deseja-se incluir nas próximas versões:
%
%\begin{itemize}
%	\item \textbf{Instrumentos de medição:} Permitir que o usuário obtenha informações a respeito de frequência de oscilação, \textit{duty cycle}, etc. nos pinos de saída.
%	
%	\item \textbf{Visualização da memória:} Apresentar ao usuário o estado dos registradores e da memória externa em tempo real de simulação.
%	
%	\item \textbf{Criação de novos módulos:} Vários módulos e funcionalidades do ATmega328P ainda não foram adicionados e devem ser incluídos para as próximas versões, tais como comparador analógico, memória EEPROM, etc.
%	
%	\item \textbf{Comunicação serial:} Entre os módulos não implementados, a USART é um dos principais e deve ser o primeiro a ser trabalhado. Espera-se também utilizar o monitor serial da própria IDE do Arduino (assim como ocorre nos sistema real) de modo a facilitar seu uso.
%\end{itemize}
%
%\par Além disso, serão estudadas maneiras de aumentar o desempenho da simulação, seja por meio de alterações internas no sistema ou com otimizações externas. 
%
%\newpage
%\subsection{Cronograma de Atividades}
%
%\par A tabela~\ref{tab:cronograma} apresenta o cronograma executado até o momento em relação ao planejado.
%
%\begin{table}[h]
%	\centering
%	\caption{Cronograma}
%	\label{tab:cronograma}
%	\begin{tabular}{|c|c|c|c|c|c|c|c|c|c|c|}
%		\hline
%		& 03/18 & 04/18 & 05/18 & 06/18 & 07/18 & 08/18 & 09/18 & 10/18 & 11/18 & 12/18 \\ \hline
%		\multirow{2}{*}{01} & \cellcolor{blue!25} & \cellcolor{blue!25} &  &  &  &  &  &  &  &  \\ \hhline{|~|----------} 
%		& \cellcolor{green!25} & \cellcolor{green!25} & \cellcolor{green!25} &  &  &  &  &  &  &  \\ \hline
%		\multirow{2}{*}{02} &  & \cellcolor{blue!25} &  &  &  &  &  &  &  &  \\ \hhline{|~|----------} 
%		& \cellcolor{green!25} &  &  &  &  &  &  &  &  &  \\ \hline
%		\multirow{2}{*}{03} &  & \cellcolor{blue!25} & \cellcolor{blue!25} &  &  &  &  &  &  &  \\ \hhline{|~|----------}  
%		& \cellcolor{green!25} & \cellcolor{green!25} & \cellcolor{green!25} &  &  &  &  &  &  &  \\ \hline
%		\multirow{2}{*}{04} &  &  & \cellcolor{blue!25} & \cellcolor{blue!25} &  &  &  &  &  &  \\ \hhline{|~|----------}  
%		& \cellcolor{green!25} & \cellcolor{green!25} & \cellcolor{green!25} &  &  &  &  &  &  &  \\ \hline
%		\multirow{2}{*}{05} &  &  &  &  & \cellcolor{blue!25} &  &  &  &  &  \\ \hhline{|~|----------}  
%		&  & \cellcolor{green!25} &  &  &  &  &  &  &  &  \\ \hline
%		\multirow{2}{*}{06} &  &  &  &  &  & \cellcolor{blue!25} & \cellcolor{blue!25} &  &  &  \\ \hhline{|~|----------}  
%		&  & \cellcolor{green!25} &  &  &  &  &  &  &  &  \\ \hline
%		\multirow{2}{*}{07} &  &  &  &  &  &  & \cellcolor{blue!25} & \cellcolor{blue!25} &  &  \\ \hhline{|~|----------}  
%		&  & \cellcolor{green!25} & \cellcolor{green!25} &  &  &  &  &  &  &  \\ \hline
%		\multirow{2}{*}{08} &  & \cellcolor{blue!25} & \cellcolor{blue!25} & \cellcolor{blue!25} & \cellcolor{blue!25} & \cellcolor{blue!25} & \cellcolor{blue!25} & \cellcolor{blue!25} & \cellcolor{blue!25} &  \\ \hhline{|~|----------}  
%		&  & \cellcolor{green!25} & \cellcolor{green!25} & \cellcolor{green!25} &  &  &  &  &  &  \\ \hline
%		\multirow{2}{*}{09} &  & \cellcolor{blue!25} & \cellcolor{blue!25} & \cellcolor{blue!25} & \cellcolor{blue!25} & \cellcolor{blue!25} & \cellcolor{blue!25} & \cellcolor{blue!25} & \cellcolor{blue!25} &  \\ \hhline{|~|----------}  
%		& \cellcolor{green!25} &  & \cellcolor{green!25} &  &  &  &  &  &  &  \\ \hline
%		\cellcolor{blue!25} & \multicolumn{10}{l|}{Planejado}      \\ \hline
%		\cellcolor{green!25} & \multicolumn{10}{l|}{Executado}      \\ \hline
%	\end{tabular}
%\end{table}
%
%\begin{enumerate}
%	\item Alteração do código fonte da IDE oficial do Arduino e integração com o simulador.
%	\item Planejamento do sistema como um todo, incluindo a definição dos elementos de interface, estrutura de classes, arquitetura e demais itens relacionados à organização interna do sistema;
%	\item Decodificação do arquivo hexadecimal gerado pelo compilador e execução das instruções \textit{assembly};
%	\item Desenvolvimento do módulo de entrada e saída digital;
%	\item Detecção e tratamento de interrupções;
%	\item Desenvolvimento do módulo de \textit{timer} (8 e 16 bits);
%	\item Desenvolvimento do módulo ADC (\textit{Analog to Digital Converter});
%	\item Escrita da monografia (parcial);
%	\item Testes e validações
%\end{enumerate}












